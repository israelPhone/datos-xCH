name: Robot Actualizador
on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Instalar yt-dlp
        run: |
          sudo curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp
          sudo chmod a+rx /usr/local/bin/yt-dlp

      - name: Generar Lista IPTV
        run: |
          echo "#EXTM3U" > lista.m3u
          while IFS= read -r m || [ -n "$m" ]; do
            m=$(echo "$m" | xargs)
            [ -z "$m" ] && continue
            echo "Buscando link para: $m"
            L=$(yt-dlp --get-url --format "best" "https://chaturbate.com/$m/" 2>/dev/null || echo "")
            if [[ "$L" == http* ]]; then
              echo "#EXTINF:-1, $m" >> lista.m3u
              echo "$L" >> lista.m3u
            fi
          done < modelos.txt

      - name: Guardar cambios
        run: |
          git config --global user.name "Bot-xCH"
          git config --global user.email "bot@github.com"
          git add lista.m3u
          git commit -m "Lista actualizada $(date)" || exit 0
          git push
