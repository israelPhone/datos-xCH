name: Robot Actualizador
on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Instalar yt-dlp
        run: |
          sudo curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp
          sudo chmod a+rx /usr/local/bin/yt-dlp

      - name: Auto-Extraer y Generar Lista
        run: |
          echo "#EXTM3U" > lista.m3u
          
          # ESTA LÍNEA BUSCA LAS 50 MEJORES DE 'MILK' AUTOMÁTICAMENTE
          curl -s "https://chaturbate.com/female-cams/milk/" | grep -o 'data-room="[^"]*"' | cut -d'"' -f2 | head -n 50 > modelos_auto.txt
          
          while read m; do
            [ -z "$m" ] && continue
            L=$(yt-dlp --get-url --format "best" "https://chaturbate.com/$m/" 2>/dev/null || echo "")
            if [[ "$L" == http* ]]; then
              echo "#EXTINF:-1, $m" >> lista.m3u
              echo "$L" >> lista.m3u
            fi
          done < modelos_auto.txt

      - name: Guardar cambios
        run: |
          git config --global user.name "bot"
          git config --global user.email "bot@github.com"
          git add lista.m3u
          git commit -m "update" || exit 0
          git push
